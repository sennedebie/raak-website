{% extends "admin/base.html" %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/admin/manage_permissions.css') }}"
/>
{% endblock %} {% block title %}Rechten beheren{% endblock %} {% block content
%}

<div class="table-tile">
  <h1>Rechten beheren</h1>
  <h3>Rol-rechten toewijzing</h3>

  {% for role in roles %}
  <div class="role-group">
    <div class="role-header-container">
      <div class="role-name">
        <h2 style="display: inline">{{ role.name|capitalize }}</h2>
      </div>
      <div class="role-actions">
        <!-- Add permission modal/button can go here if needed -->
      </div>
    </div>
    <table>
      <tr>
        <th>Recht</th>
        <th>Toegewezen op</th>
        <th>Toegewezen door</th>
        <th>Acties</th>
      </tr>
      {% set permissions = permissions_by_role.get(role.id, []) %} {% if
      permissions %} {% for perm in permissions %}
      <tr>
        <td>{{ perm.name }}</td>
        <td>
          {{ perm.created_at.strftime('%Y-%m-%d %H:%M') if perm.created_at else
          '' }}
        </td>
        <td>{{ perm.created_by_username or '' }}</td>
        <td>
          <form
            action="#"
            method="post"
            style="display: inline"
            onsubmit="return confirm('Weet je zeker dat je dit recht wilt intrekken bij deze rol?');"
          >
            <button type="submit" class="icon-btn" title="Recht intrekken">
              <i class="fa-solid fa-user-minus"></i>
            </button>
          </form>
        </td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="4" style="text-align: center; color: #888">
          Geen rechten aan deze rol gekoppeld.
        </td>
      </tr>
      {% endif %}
    </table>
  </div>
  {% endfor %}
</div>

<script>
  function openModal(roleId) {
    document.getElementById("addUserModal-" + roleId).style.display = "block";
  }
  function closeModal(roleId) {
    document.getElementById("addUserModal-" + roleId).style.display = "none";
  }
  // Optional: close modal when clicking outside
  window.onclick = function (event) {
    document.querySelectorAll(".modal").forEach(function (modal) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    });
  };
</script>

{% endblock %}
